create table student
(
	usn varchar(10),
	sname varchar(10),
	address varchar(10),
	phone bigint,
	gender char(1),
	primary key(usn)
);

create table semsec
(
	ssid varchar(5),
	sem int,
	sec varchar(5),
	primary key(ssid)
);

insert into student values('CS101','Arun',‘Ujire','9481235681','M');

insert into semsec values('CS4A', 4, 'A');

create table class
(
	usn varchar(10),
	ssid varchar(5),
	primary key(usn),
	foreign key(usn) references student(usn) on delete cascade,
	foreign key(ssid) references semsec(ssid) on delete cascade
);

create table subject
(
	subcode varchar(8),
	title varchar(15),
	sem int,
	credits int,
	primary key(subcode)
);

insert into class values('CS101','CS7A');

insert into subject values('18CS31',‘Maths',‘3','5');

create table IAmarks
(
	usn varchar(10),
	subcode varchar(8),
	ssid varchar(5),
	test1 int,
	test2 int,
	test3 int,
	finalIA int,
	primary key(usn,subcode,ssid),
	foreign key(usn) references student(usn) on delete cascade,
	foreign key(subcode) references subject(subcode),
	foreign key(ssid) references semsec(ssid)
);

insert into IAmarks values('CS101','17CS71','CS7A',19,20,18,NULL);

4.1)
SELECT S.*, SS.SEM, SS.SEC
FROM STUDENT S, SEMSEC SS, CLASS C
WHERE S.USN = C.USN AND SS.SSID = C.SSID AND SS.SEM = 3 AND 
              SS.SEC=”C”;

4.2)
SELECT SS.SEM, SS.SEC, S.GENDER, COUNT(S.GENDER) AS COUNT 
FROM STUDENT S, SEMSEC SS, CLASS C 
WHERE  S.USN =C.USN AND SS.SSID = C.SSID
GROUP BY S.GENDER
ORDER BY SEM;

4.3)
CREATE VIEW STU_TEST1_MARKS_VIEW AS
	SELECT test1, subcode
	FROM IAmarks
	WHERE usn = ‘CS101’;

4.4)
create view best_two_finder as 
(  select usn, subcode, greatest(test1,test2,test3) as highest, 
   case 
	when test1<=greatest(test1,test2,test3) and test1>least(test1,test2,test3) then test1
	when test2<=greatest(test1,test2,test3) and test2>least(test1,test2,test3) then test2
   else test3
   end as secondhighest from iamarks
);
 
select * from best_two_finder;
 
create view average2 as (select subcode, ((highest+secondhighest)/2) as final from best_two_finder);
 
select * from average2;
update iamarks join average2 
on iamarks.subcode=average2.subcode
set iamarks.finalIA=average2.final;



4.5)
SELECT S.USN, S.SNAME, S.ADDRESS, S.PHONE, S.GENDER,
       (CASE 
          WHEN IA.FINALIA BETWEEN 17 AND 20 THEN 'OUTSTANDING'
          WHEN IA.FINALIA BETWEEN 12 AND 16 THEN 'AVERAGE'
          ELSE 'WEAK'
       END) AS CAT
FROM STUDENT S, SEMSEC SS, IAMARKS IA, SUBJECT SUB
WHERE S.USN = IA.USN AND 
SS.SSID = IA.SSID AND
SUB.SUBCODE = IA.SUBCODE AND
SUB.SEM = 7;
—-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE TABLE DEPARTMENT 
(DNO VARCHAR2 (20) PRIMARY KEY, 
DNAME VARCHAR2 (20), 
MGRSTARTDATE DATE);

CREATE TABLE EMPLOYEE 
(SSN VARCHAR2 (20) PRIMARY 
KEY, FNAME VARCHAR2 (20), 
LNAME VARCHAR2 (20), 
ADDRESS VARCHAR2 (20),
SEX CHAR (1), 
SALARY INTEGER,
SUPERSSN REFERENCES EMPLOYEE 
(SSN), DNO REFERENCES DEPARTMENT 
(DNO));
ALTER TABLE DEPARTMENT
ADD MGRSSN REFERENCES EMPLOYEE (SSN);

CREATE TABLE 
DLOCATION (DLOC 
VARCHAR2 (20),
DNO REFERENCES DEPARTMENT 
(DNO), PRIMARY KEY (DNO, DLOC));

CREATE TABLE PROJECT 
(PNO INTEGER PRIMARY
KEY, PNAME VARCHAR2 (20), 
PLOCATION VARCHAR2 (20),
DNO REFERENCES DEPARTMENT (DNO));

CREATE TABLE 
WORKS_ON (HOURS 
NUMBER (2),
SSN REFERENCES EMPLOYEE 
(SSN), PNO REFERENCES 
PROJECT(PNO), PRIMARY KEY 
(SSN, PNO));

DESC EMPLOYEE;

DESC DEPARTMENT;

DESC DLOCATION;

DESC PROJECT;

DESC WORKS_ON; 

INSERT INTO EMPLOYEE VALUES (‗RNSECE01„,„JOHN„,„SCOTT„,„BANGALORE„,„M„, 450000); 

INSERT INTO DEPARTMENT VALUES (‗1„,„ACCOUNTS„,„01-JAN-
01„,„RNSACC02„); INSERT INTO DEPARTMENT VALUES (‗2„,„IT„,„01-AUG-
16„,„RNSIT01„);

UPDATE EMPLOYEE SET 
SUPERSSN=NULL, 
DNO=„3„ WHERE 
SSN=„RNSECE01„;


INSERT INTO DLOCATION VALUES („BANGALORE„, ‗1„); 

INSERT INTO PROJECT VALUES (100,„IOT„,„BANGALORE„,„5„); 

INSERT INTO WORKS_ON VALUES (4, ‗RNSCSE01„, 100); 

SELECT * FROM EMPLOYEE; 

SELECT * FROM DEPARTMENT;

SELECT * FROM DLOCATION;

SELECT * FROM PROJECT;

SELECT * FROM WORKS_ON; 

(SELECT DISTINCT P.PNO
FROM PROJECT P, DEPARTMENT D, EMPLOYEE E 
WHERE E.DNO=D.DNO 
AND D.MGRSSN=E.SSN 
AND E.LNAME=„SCOTT„) 
UNION
(SELECT DISTINCT P1.PNO
FROM PROJECT P1, WORKS_ON W, EMPLOYEE E1
WHERE P1.PNO=W.PNO 
AND E1.SSN=W.SSN 
AND E1.LNAME=„SCOTT„);

SELECT E.FNAME, E.LNAME, 1.1*E.SALARY AS INCR_SAL 
FROM EMPLOYEE E, WORKS_ON W, PROJECT P
WHERE E.SSN=W.SSN 
AND W.PNO=P.PNO 
AND P.PNAME=„IOT„;

SELECT SUM (E.SALARY), MAX (E.SALARY), MIN (E.SALARY), AVG 
(E.SALARY)
FROM EMPLOYEE E, DEPARTMENT D 
WHERE E.DNO=D.DNO 
AND D.DNAME=„ACCOUNTS„;

SELECT E.FNAME, E.LNAME 
FROM EMPLOYEE E 
WHERE NOT EXISTS((SELECT PNO 
FROM PROJECT
WHERE DNO=„5„) MINUS (SELECT PNO FROM 
WORKS_ON WHERE E.SSN=SSN));

SELECT D.DNO, COUNT (*)
FROM DEPARTMENT D, EMPLOYEE E
WHERE D.DNO=E.DNO 
AND E.SALARY>600000
AND D.DNO IN (SELECT E1.DNO 
FROM EMPLOYEE E1 GROUP BY 
E1.DNO HAVING COUNT (*)>5) 
GROUP BY D.DNO;
